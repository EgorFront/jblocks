# JBlocks

Нанофреймворк (~ 100 строк) для организации блоков на странице построенный на базе jQuery.

Строится на трех основных принципах:

- опиши поведение своих блоков в декларации
- пометь свои блоки в html с помощью специальных атрибутов
- общайся с блоками через АПИ

## Описание блоков в html

В разметке помечаем блоки с помощью специальных data-атрибутов:

- `data-b` — айдишник блока (имя)
- `data-p` — параметры блока

```html
<!--
    Пусть у нас есть счетчик: кнопки +/- при нажатии на которые
    меняется значение счетчика — чиселка рядом с кнопками
-->
<div class="foo" data-b="сounter" data-p='{ "step": 2 }'>
    <button class="js-inc">+</button>
    <button class="js-dec">-</button>
    <span class="js-info">0</span>
</div>
```

## Декларация поведения блоков

В джаваскрипте нужно описать поведение блока:

```js
$.define('сounter', {
    events: {
        'b-inited': 'oninit',
        'click .js-inc': 'onClickPlus',
        'click .js-dec': 'onClickMinus'
    },

    methods: {
        oninit: function() {
            this.$info = this.$node.find('.js-info');
            this.count = 0;
        },

        /**
         * Обработчик клика на плюс
         */
        onClickPlus: function() {
            this.inc();
            this.update();
        },

        /**
         * Обработчик клика на минус
         */
        onClickMinus: function() {
            this.dec();
            this.update();
        },

        /**
         * Увеличить счетчик
         */
        inc: function() {
            this.count += this.params.step;
        },

        /**
         * Уменьшить счетчик
         */
        dec: function() {
            this.count -= this.params.step;
        },

        /**
         * Нарисует новое значение
         */
        update: function() {
            this.$info.text(this.count);
        }
    }
});

// Инициализируем все блоки в документе
$(document).initBlocks();
```

## events

`click .foo` — какое событие слушаем и необязательно уточняющий селектор (события навешиваются через делегирование на ноду блока)

Значением может быть строчка — имя функции из секции `methods` в декларации или анонимная функция. Функция будет выполнены в контексте блока.

Стандартные события блока:

- `b-inited` выполнятся после инициализации блока
- `b-destroyed` выполнятся после уничтожения блока

## methods

Здесь указываются методы блока, по сути, его прототип. Выполняются в контексте конкретного экземпляра блока.

## Работа с блоками через АПИ

Есть возможность получать экземпляры блока с помощью метода `getBlocks`, который доступен в прототипе `jQuery`, и вызывать методы блоков, которые были в декларации:

```js
var blocks = $('.bar').getBlocks();

blocks.each(function() {
    // this - экземпляр блока, увеличит счетчик
    this.inc();
})
```

Так же можно создавать и удалять блоки, которые находятся внутри определенного элемента страницы, например, во всем документе при инициализации приложения:

```js
// Инициализируем все блоки в документе
$(document).initBlocks();
```

Аналогично для уничтожения:

```js
$(document).destroyBlocks();
```
