# JBlocks

Нанофреймворк для организации блоков на странице

## Описание блоков в html

В разметке помечаем блоки с помощью специальных data-атрибутов:

- `data-b` — айдишник блока (имя)
- `data-p` — параметры блока

```html
<!-- Блок счетчика: обладает js-функциональностью -->
<div class="bar" data-b="counter" data-p='{ "step": "2" }'>
    <button class="js-count">+</button>
    <span class="js-info">0</span>
</div>
```

## Декларация поведения блоков

В джаваскрипте нужно описать поведение блока:

```js
$.jb.define('my-block', {

    // События: встроенные события блока и DOM-события его элементов
    events: {
        'b-inited': 'oninit',
        'click .js-inc': 'onClickPlus',
        'click .js-dec': 'onClickMinus'
    },

    // Методы: то, что можно указывать в события, а так же его открытое АПИ
    // Эти методы можно дернуть, получив экземпляр блока через getBlocks
    methods: {
        oninit: function() {
            this.$info = this.$node.find('.js-info');
            this.count = 0;
        },

        onClickPlus: function() {
            this.inc();
            this.update();
        },

        onClickMinus: function() {
            this.dec();
            this.update();
        },

        /**
         * Увеличить счетчик
         */
        inc: function() {
            this.count += this.params.step;
        },

        /**
         * Уменьшить счетчик
         */
        dec: function() {

        },

        /**
         * Нарисует новое значение
         */
        update: function() {
            this.$info.text(this.count);
        }
    }
});
```

## events

`click .foo` — какое событие слушаем и необязательно уточняющий селектор (события навешиваются через делегирование на ноду блока)

Значением может быть строчка — имя функции из секции `methods` в декларации или анонимная функция. Функция будет выполнены в контексте блока.

Стандартные события блока:

- `b-init` выполнятся при инициализации блока
- `b-destroy` выполнятся при уничтожении блока

## methods

Здесь указываются методы блока, по сути, его прототип. Выполняются в контексте конкретного экземпляра блока.

## Работа с блоками через АПИ

Есть возможность получать экземпляры блока с помощью метода `getBlocks`, который доступен в прототипе `jQuery`, и вызывать методы блоков, которые были в декларации:

```js
var blocks = $('.bar').getBlocks();

blocks.each(function() {
    // this - экземпляр блока
    this.inc();
})
```
